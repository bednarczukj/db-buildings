---
import "../styles/global.css";
import LogoutButton from "../components/shared/LogoutButton";
import { Navigation } from "../components/shared/Navigation";

interface Props {
  title?: string;
}

const { title = "Baza Budynków Polski" } = Astro.props;
const user = Astro.locals.user;
// supabase is not needed here anymore
// const supabase = Astro.locals.supabase;

// Get user role from locals (already set by middleware)
// No need to fetch from database again
const userRole = user?.role || null;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body>
    <header class="bg-white border-b border-border">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          {/* Logo/Brand */}
          <div class="flex items-center">
            <a href="/" class="text-xl font-bold text-foreground hover:text-primary transition-colors">
              Baza Budynków Polski
            </a>
          </div>

          {/* Navigation */}
          <nav class="flex items-center space-x-4">
            {
              user ? (
                <>
                  {/* Authenticated user navigation */}
                  <Navigation user={user} userRole={userRole} client:load />

                  {/* User info and logout */}
                  <div class="flex items-center space-x-4 ml-4 pl-4 border-l border-border">
                    <span class="text-sm text-muted-foreground">{user.email}</span>
                    <LogoutButton client:load />
                  </div>
                </>
              ) : (
                <>
                  {/* Guest navigation */}
                  <a
                    href="/auth/login"
                    class="text-sm font-medium text-foreground hover:text-primary transition-colors"
                  >
                    Zaloguj się
                  </a>
                  <a
                    href="/auth/register"
                    class="text-sm font-medium text-primary hover:text-primary/80 transition-colors"
                  >
                    Zarejestruj się
                  </a>
                </>
              )
            }
          </nav>
        </div>
      </div>
    </header>
    <slot />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
